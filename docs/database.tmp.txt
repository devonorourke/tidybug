
VSEARCH provides a the summary of the clustering process - note how the number of clusters and singletons change with percent identity (higher %id increase number of clusters and decrease singletons relative to a lower percent identity):

For select 10 Orders:
```
## for 99% identity:
Clusters: 33946 Size min 1, max 271, avg 2.7
Singletons: 19819, 21.5% of seqs, 58.4% of clusters

## for 97% identity:
Clusters: 25482 Size min 1, max 611, avg 3.6
Singletons: 12596, 13.6% of seqs, 49.4% of clusters

## for 95% identity:
Clusters: 21709 Size min 1, max 627, avg 4.3
Singletons: 9832, 10.6% of seqs, 45.3% of clusters
```

For all Arthropods:
```
## pid99
Clusters: 38833 Size min 1, max 459, avg 2.8
Singletons: 22533, 20.4% of seqs, 58.0% of clusters

## pid97
Clusters: 28811 Size min 1, max 729, avg 3.8
Singletons: 14168, 12.8% of seqs, 49.2% of clusters

## pid95
Clusters: 24639 Size min 1, max 729, avg 4.5
Singletons: 11137, 10.1% of seqs, 45.2% of clusters
```

> As expected, there are more clusters in the full Arthropod dataset than the 10 select Orders, but not substantially more: the selected Orders contain between 87-88% as many clusters as the full Arthropod set.

## Collect data from each set:
An overview of the two items we'll be working on:

1. Calculate for taxonomic completeness:
We want to calculate, for a given fasta file, the number of taxa with some information across various taxonomic levels (Class, Order, Family, Genus, Species). We'd predict that there should be 100% of Class information for all of these, because we specified our 10 taxonomic Orders in the initial pull of BOLD data (thus, there couldn't have been any sequences lacking Class designation). However, we'd also expect 100% of our Order assignments to be returned, but this may not always be the case because Vsearch can find _ties_ and break back to the common ancestor among matches; the result is that if two distinct Orders are matches, we'll _lose_ Order information and retain only Class info. The same effect holds true across all taxa levels. Thus our table in part 1 is a calculation examining the loss of taxonomic completeness as a result of clustering.

2. Calculate proportional representation by clustering:
If all taxonomic Orders contain representative COI sequences equally similar in their variability, clustering should not change the proportions of our 10 Orders. That is, as we cluster from all unique sequence variants to 99% identity to 97% and 95% identity, the relative proportion of sequences assigned to any given Order should be constant. If, however, certain Orders are more similar to each other than others, the less variable sequences will generate fewer centroids (and cluster more) which results in a decrease in relative proportion among other Orders. We can examine this effect with Waffle plots, which will depict the percent of sequences attributed to a given Order: each cell in the 10x10 grid represents 1% of the overall sequence space (note in this case we have 10 colored orders, plus 1 additional variable of "Undefined" to indicate those sequences which did not get assigned any Order (because of the "tie" effect when multiple Orders cluster together))

### Taxonomic completeness
First, collect the taxa strings for each of the 5 fasta files generated in the database of interest (select 10 Orders or full Arthropod), then combine into a single file:
```
declare -a arr=("clean" "derep" "pid99" "pid97" "pid95")
for i in "${arr[@]}"; do
grep "^>" boldCustom."$i".fasta | sed 's/^>//' | \
awk -F ";tax=k__Animalia;p__Arthropoda;" '{OFS="\t"};{print $1,$2}' | sed 's/.__/__/g' | \
awk -v var=$i -F "\t" '{OFS="\t"};{print $1,$2,var}' > "$i".taxa.tmp;
done

cat *.taxa.tmp > all.taxa.txt
rm *.taxa.tmp
```
> substitute 'boldCustom."$i".fasta' with 'boldCustom.allArthUS."$i".fasta' for full Arthropod dataset
> substitute 'select.taxa.txt' with 'all.taxa_full.txt' for full Arthropod dataset

Import the `*.taxa.txt` files into an R session to generate the frequency table. See `boldCustomDataplots.R` script for details.

Without running the R script we can use a bash tools to determine the number of sequences containing unique taxonomic identities in each dataset. For instance, this one-liner would demonstrate the number of unique Class taxa listed in a fasta file of interest:

```
$: grep "^>" boldCustom.allArthUS.pid95.fasta | cut -d ';' -f 4 | sort -u | wc -l
14
```
> substitute the `sort -u | wc` with `sort | uniq -c` to get a per-taxa count of each of the 14 taxa Classes

There are 14 unique Classes in the full arthropod dataset.

However, this is much easier to quantify with R's tools, and the data table below was created using the aforementioned R script. This produces the following pair of tables which represent the number of unique sequences assigned some level of taxonomic information. Thus for a value of "2" at the Class level, this indicates there are two arthropod Classes (Insecta and Arachnidia); likewise at the Order level we see (as expected) 10 unique items in the selected dataset (the 10 we selected!), but XYS Orders in the full Arthropod dataset.

For select Orders:
```
| Level | clean | derep | pid99 | pid97 | pid95
| --- | --- |
| Class | 2 | 2 | 2 | 2 | 2
| Order | 10 | 10 | 10 | 10 | 10
| Family | 495 | 494 | 485 | 473 | 468
| Genus | 4346 | 4325 | 4088 | 3948 | 3828
| Species | 11356 | 11141 | 9779 | 8638 | 7495
| total | 132682 | 92352 | 33946 | 25483 | 21712
```

For all Arthropods:
```
| Level | clean | derep | pid99 | pid97 | pid95
| --- | --- |
| Class | 2 | 2 | 2 | 2 | 2
| Order | 10 | 10 | 10 | 10 | 10
| Family | 495 | 494 | 485 | 473 | 468
| Genus | 4346 | 4325 | 4088 | 3948 | 3828
| Species | 11356 | 11141 | 9779 | 8638 | 7495
| total | 132682 | 92352 | 33946 | 25483 | 21712
```
